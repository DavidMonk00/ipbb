#!/usr/bin/env python
from __future__ import print_function


#--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# Modules
import click
import subprocess
import ipbb

# Elements
from click_shell import shell
from os.path import join, split, exists, splitext

#------------------------------------------------------------------------------
# @click.group()  # no longer
@shell(prompt='\x1b[38;5;74mipbb\x1b[0m> ', intro='Starting IPBus Builder...')
@click.pass_context
def cli(ctx):
  ctx.obj = ipbb.Environment()
#------------------------------------------------------------------------------

#------------------------------------------------------------------------------
@cli.command()
def info():
  '''Tentative command to set up shell env'''
  print( 'export IPBB_ROOT=%s' % ipbb.env.root)
  print( 'export IPBB_WORK=%s' % ipbb.env.work)
#------------------------------------------------------------------------------

#------------------------------------------------------------------------------
if __name__ == '__main__':
  '''Discovers the env at startup'''
  # ipbb.env = ipbb.Environment()
  # print(ipbb.__env)

  # Add custom commands to shell
  import ipbb.repo
  cli.add_command(ipbb.repo.init)
  cli.add_command(ipbb.repo.add)

  import ipbb.vivado
  cli.add_command(ipbb.vivado.vivado)



  cli.shell.prompt = '\x1b[38;5;74m'+cli.shell.prompt+'\x1b[0m'
  cli()
#------------------------------------------------------------------------------
